/*
 * timer.c
 *
 *  Created on: Jul 18, 2017
 *      Author: Jaan Horng
 */

#include "stm32f1xx_hal.h"
#include "callback.h"
#include "event.h"
#include "ow_state_machine.h"

EventCallback uart1Tx = {NULL, NULL};
EventCallback uart1Rx = {NULL, NULL};
EventCallback timer2 = {NULL, NULL};

void registerCallbacks(EventCallback eventCallback, EventCallbackFunc ongoing, EventCallbackFunc next){
  eventCallback.ongoing = ongoing;
  eventCallback.next = next;
}

/*
 * @brief This is the callback for non-blocking mode of uart when data transmission has completed.
 */
void HAL_UART_TxCpltCallback(UART_HandleTypeDef *huart){
	oneWireSM(UART_TX_CPL_EVT);
}

/*
 * @brief This is the callback for non-blocking mode of uart when data reception has completed.
 */
void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart){
	oneWireSM(UART_RX_CPL_EVT);
}

/*
 * @brief This is the callback for non-blocking mode of timer when the assigned timing period has elapsed.
 */
void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim){
	oneWireSM(TIMEOUT_EVT);
}
